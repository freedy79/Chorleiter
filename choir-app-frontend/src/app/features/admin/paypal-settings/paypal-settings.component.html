<div class="paypal-settings-container">
  <!-- Loading State -->
  @if (loading) {
    <div class="loading-state">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Lade PayPal-Einstellungen...</p>
    </div>
  }

  <!-- Content -->
  @if (!loading) {
    <div>
      @if (!dialogRef) {
        <h2 class="settings-title">PayPal PDT Einstellungen</h2>
      }
      @if (dialogRef) {
        <h2 mat-dialog-title>PayPal PDT Einstellungen</h2>
      }

      <div [class.dialog-content]="dialogRef" [class.embedded-content]="!dialogRef">
        @if (pdtConfigured) {
          <div class="success-banner">
            <mat-icon>check_circle</mat-icon>
            <span>PayPal PDT ist konfiguriert und einsatzbereit.</span>
          </div>
        }

        @if (saved) {
          <div class="success-banner">
            <mat-icon>check_circle</mat-icon>
            <span>Einstellungen erfolgreich gespeichert!</span>
          </div>
        }

        @if (error) {
          <div class="error-banner">
            <mat-icon>error</mat-icon>
            <span>{{ error }}</span>
          </div>
        }

      <mat-form-field class="full-width">
        <mat-label>PayPal Modus</mat-label>
        <mat-select [(ngModel)]="mode">
          <mat-option value="sandbox">Sandbox (Test)</mat-option>
          <mat-option value="live">Live (Produktion)</mat-option>
        </mat-select>
        <mat-hint>Wählen Sie "Sandbox" für Tests, "Live" für echte Spenden</mat-hint>
      </mat-form-field>

      <mat-form-field class="full-width">
        <mat-label>Spendenmail-Adresse</mat-label>
        <input matInput
               type="email"
               [(ngModel)]="donationEmail"
               placeholder="Beispiel: spenden@example.de">
        <mat-icon matSuffix>email</mat-icon>
        <mat-hint>Die PayPal-Adresse, an die Spenden gesendet werden sollen</mat-hint>
      </mat-form-field>

      <mat-form-field class="full-width">
        <mat-label>PDT Identity Token</mat-label>
        <input matInput
               [type]="showToken ? 'text' : 'password'"
               [(ngModel)]="pdtToken"
               placeholder="Ihren PayPal PDT Token hier einfügen"
               [disabled]="saving">
        <button mat-icon-button matIconSuffix (click)="showToken = !showToken" type="button">
          <mat-icon>{{ showToken ? 'visibility' : 'visibility_off' }}</mat-icon>
        </button>
        <mat-hint>
          Sie erhalten diesen Token in PayPal Website-Zahlungen → Payment Data Transfer (PDT)
        </mat-hint>
      </mat-form-field>

      <div class="help-section">
        <h4>Hilfe: Wie bekomme ich den PDT Token?</h4>
        <ol>
          <li>Melden Sie sich bei PayPal an</li>
          <li>Gehen Sie zu <strong>Einstellungen → Website-Zahlungen</strong></li>
          <li>Suchen Sie <strong>Payment Data Transfer (PDT)</strong></li>
          <li>Aktivieren Sie PDT</li>
          <li>Kopieren Sie den <strong>PDT Identity Token</strong></li>
          <li>Fügen Sie ihn oben ein und speichern Sie</li>
        </ol>
      </div>
    </div>

    <div class="actions" [class.dialog-actions]="dialogRef" [class.embedded-actions]="!dialogRef">
      @if (dialogRef) {
        <button mat-button (click)="close()">Abbrechen</button>
      }
      <button mat-raised-button color="primary"
              (click)="saveSettings()"
              [disabled]="saving || !pdtToken || !donationEmail">
        @if (!saving) {
          <mat-icon>save</mat-icon>
        }
        @if (saving) {
          <mat-spinner diameter="20" class="button-spinner"></mat-spinner>
        }
        {{ saving ? 'Wird gespeichert...' : 'Speichern' }}
      </button>
    </div>
  </div>
  }
</div>
