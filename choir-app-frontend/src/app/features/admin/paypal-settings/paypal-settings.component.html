<h2 mat-dialog-title>PayPal PDT Einstellungen</h2>

<mat-dialog-content>
  <div *ngIf="pdtConfigured" style="margin-bottom: 20px; padding: 12px; background-color: #e8f5e9; border-left: 4px solid #4caf50; border-radius: 4px;">
    <mat-icon style="color: #4caf50; vertical-align: middle;">check_circle</mat-icon>
    <span style="color: #2e7d32; margin-left: 8px;">PayPal PDT ist konfiguriert und einsatzbereit.</span>
  </div>

  <div *ngIf="saved" style="margin-bottom: 20px; padding: 12px; background-color: #e8f5e9; border-left: 4px solid #4caf50; border-radius: 4px;">
    <mat-icon style="color: #4caf50; vertical-align: middle;">check_circle</mat-icon>
    <span style="color: #2e7d32; margin-left: 8px;">Einstellungen erfolgreich gespeichert!</span>
  </div>

  <div *ngIf="error" style="margin-bottom: 20px; padding: 12px; background-color: #ffebee; border-left: 4px solid #d32f2f; border-radius: 4px;">
    <mat-icon style="color: #d32f2f; vertical-align: middle;">error</mat-icon>
    <span style="color: #c62828; margin-left: 8px;">{{ error }}</span>
  </div>

  <mat-form-field style="width: 100%; margin-bottom: 16px;">
    <mat-label>PayPal Modus</mat-label>
    <mat-select [(ngModel)]="mode">
      <mat-option value="sandbox">Sandbox (Test)</mat-option>
      <mat-option value="live">Live (Produktion)</mat-option>
    </mat-select>
    <mat-hint>Wählen Sie "Sandbox" für Tests, "Live" für echte Spenden</mat-hint>
  </mat-form-field>

  <mat-form-field style="width: 100%; margin-bottom: 16px;">
    <mat-label>Spendenmail-Adresse</mat-label>
    <input matInput
           type="email"
           [(ngModel)]="donationEmail"
           placeholder="Beispiel: spenden@example.de">
    <mat-icon matSuffix>email</mat-icon>
    <mat-hint>Die PayPal-Adresse, an die Spenden gesendet werden sollen</mat-hint>
  </mat-form-field>

  <mat-form-field style="width: 100%; margin-bottom: 16px;">
    <mat-label>PDT Identity Token</mat-label>
    <input matInput
           [type]="showToken ? 'text' : 'password'"
           [(ngModel)]="pdtToken"
           placeholder="Ihren PayPal PDT Token hier einfügen">
    <button mat-icon-button matIconSuffix (click)="showToken = !showToken" type="button">
      <mat-icon>{{ showToken ? 'visibility' : 'visibility_off' }}</mat-icon>
    </button>
    <mat-hint>
      Sie erhalten diesen Token in PayPal Website-Zahlungen → Payment Data Transfer (PDT)
    </mat-hint>
  </mat-form-field>

  <div style="margin-top: 16px; padding: 16px; background-color: #f5f5f5; border-radius: 4px;">
    <h4 style="margin-top: 0;">Hilfe: Wie bekomme ich den PDT Token?</h4>
    <ol style="margin: 0; padding-left: 20px;">
      <li>Melden Sie sich bei PayPal an</li>
      <li>Gehen Sie zu <strong>Einstellungen → Website-Zahlungen</strong></li>
      <li>Suchen Sie <strong>Payment Data Transfer (PDT)</strong></li>
      <li>Aktivieren Sie PDT</li>
      <li>Kopieren Sie den <strong>PDT Identity Token</strong></li>
      <li>Fügen Sie ihn oben ein und speichern Sie</li>
    </ol>
  </div>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="close()">Abbrechen</button>
  <button mat-raised-button color="primary"
          (click)="saveSettings()"
          [disabled]="saving || !pdtToken || !donationEmail">
    <mat-icon *ngIf="!saving">save</mat-icon>
    <mat-spinner *ngIf="saving" diameter="20" style="display: inline-block; margin-right: 8px;"></mat-spinner>
    {{ saving ? 'Wird gespeichert...' : 'Speichern' }}
  </button>
</mat-dialog-actions>
