<ng-container *ngIf="vm$ | async as vm">
<div class="dashboard-layout">

  <div class="dashboard-container">
    <div class="main-content">


        <div class="hero">
          <div class="dashboard-header">
            <h1 *ngIf="(activeChoir$ | async)?.name as name">
              Willkommen bei {{ name }}
            </h1>
            <button *ngIf="(isSingerOnly$ | async) !== true" mat-icon-button color="primary" (click)="openAddEventDialog()"
              matTooltip="Neues Ereignis erstellen">
              <mat-icon>add</mat-icon>
            </button>
            <button mat-icon-button color="accent" routerLink="/events" matTooltip="Alle Ereignisse">
              <mat-icon>list</mat-icon>
            </button>
          </div>

          <app-kpi-widget [items]="[
              { label: 'Nächste Probe', value: (vm.nextRehearsal?.date | pureDate | date:'dd.MM.':'Europe/Berlin':'de-DE') || '–' },
              { label: 'Angemeldete Sänger:innen', value: (memberCount$ | async) || '-' },
              { label: 'Letzter Beitrag', value: timeAgo(vm.latestPost?.updatedAt || '') || '-' }
            ]">
          </app-kpi-widget>
<!--
          <app-status-chips-widget
            [chips]="[
              { label: 'Audio-Technik OK', status: 'ok' },
              { label: 'Liedabgleich offen', status: 'warn' },
              { label: '2 fehlende Noten', status: 'bad' }
            ]">
          </app-status-chips-widget>

          <app-quick-actions-widget
            (exportIcs)="downloadIcs()"
            (connectGoogle)="connectGoogleCalendar()"
            (createEvent)="openAddEventDialog()">
          </app-quick-actions-widget>

          -->
        </div>


        <!-- GRID (links/rechts) -->
        <section class="content-grid" role="region" aria-labelledby="next-events">
          <app-dashboard-contact-widget
            class="right-tile"
            [contact]="vm.dashboardContact">
          </app-dashboard-contact-widget>

          <app-upcoming-events-widget
            [events]="vm.upcomingEvents" [choirColors]="choirColors"
            (open)="openEvent($event)" class="left-tile">
          </app-upcoming-events-widget>

          <app-latest-post-widget
            [post]="vm.latestPost" class="right-tile">
          </app-latest-post-widget>

          <app-event-card *ngIf="vm.lastService as lastService"
                          cardTitle="Letzter Gottesdienst" [event]="lastService" class="left-tile">
          </app-event-card>

          <app-current-program-widget *ngIf="vm.lastProgram as lastProgram" [program]="lastProgram"
              cardTitle="Aktuelles Programm" class="left-tile">
          </app-current-program-widget>


          <mat-card class="calendar-card right-tile" role="region" aria-labelledby="my-dates">
            <mat-card-header>
              <mat-card-title id="my-dates">Meine Termine</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <app-my-calendar [showTitle]="false"></app-my-calendar>
            </mat-card-content>
          </mat-card>

          <app-event-card *ngIf="vm.lastRehearsal as lastRehearsal"
                          cardTitle="Letzte Probe" [event]="lastRehearsal" class="left-tile">
          </app-event-card>

        </section>
    </div>
  </div>
</div>
</ng-container>
