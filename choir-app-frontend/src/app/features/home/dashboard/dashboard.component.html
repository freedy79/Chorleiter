<ng-container *ngIf="vm$ | async as vm">
<div class="dashboard-layout">

  <div class="dashboard-container">
    <div class="main-content">


        <div class="hero">
          <div class="dashboard-header">
            <div class="title-block" *ngIf="(activeChoir$ | async)?.name as name">
              <h1>
                Willkommen bei {{ name }}
              </h1>
              <p class="subline">Aktuelle Übersicht deines Projektchors</p>
            </div>

            <div class="header-actions">
              <button *ngIf="(isSingerOnly$ | async) !== true" mat-stroked-button color="primary" (click)="openAddEventDialog()"
                matTooltip="Neues Ereignis erstellen" class="hide-on-mobile">
                <mat-icon>add</mat-icon>
                <span>Neues Ereignis</span>
              </button>
              <button mat-stroked-button color="accent" routerLink="/events" matTooltip="Alle Ereignisse" class="hide-on-mobile">
                <mat-icon>list</mat-icon>
                <span>Alle Ereignisse</span>
              </button>
            </div>
          </div>

          <app-kpi-widget [items]="[
              { label: 'Nächste Probe', value: (vm.nextRehearsal?.date | pureDate | date:'dd.MM.':'Europe/Berlin':'de-DE') || '–' },
              { label: 'Angemeldete Sänger:innen', value: (memberCount$ | async) || '-' },
              { label: 'Letzter Beitrag', value: timeAgo(vm.latestPost?.updatedAt || '') || '-' }
            ]" class="hide-on-mobile">
          </app-kpi-widget>
<!--
          <app-status-chips-widget
            [chips]="[
              { label: 'Audio-Technik OK', status: 'ok' },
              { label: 'Liedabgleich offen', status: 'warn' },
              { label: '2 fehlende Noten', status: 'bad' }
            ]">
          </app-status-chips-widget>

          <app-quick-actions-widget
            (exportIcs)="downloadIcs()"
            (connectGoogle)="connectGoogleCalendar()"
            (createEvent)="openAddEventDialog()">
          </app-quick-actions-widget>

          -->
        </div>


        <!-- GRID (links/rechts) -->
        <section class="content-grid" role="region" aria-labelledby="next-events">
          <div class="content-column content-column--primary">
            <app-upcoming-events-widget
              [events]="vm.upcomingEvents" [choirColors]="choirColors"
              (open)="openEvent($event)">
            </app-upcoming-events-widget>

            <app-event-card *ngIf="vm.lastService as lastService"
                            cardTitle="Letzter Gottesdienst" [event]="lastService">
            </app-event-card>

            <app-current-program-widget *ngIf="vm.lastProgram as lastProgram" [program]="lastProgram"
                cardTitle="Aktuelles Programm">
            </app-current-program-widget>

            <app-event-card *ngIf="vm.lastRehearsal as lastRehearsal"
                            cardTitle="Letzte Probe" [event]="lastRehearsal">
            </app-event-card>
          </div>

          <div class="content-column content-column--secondary">
            <app-dashboard-contact-widget
              *ngIf="vm.dashboardContacts.length > 0"
              [contacts]="vm.dashboardContacts">
            </app-dashboard-contact-widget>

            <ng-container *ngIf="currentLoans$ | async as currentLoans">
              <app-current-loans-widget [loans]="currentLoans"></app-current-loans-widget>
            </ng-container>

            <app-latest-post-widget
              [post]="vm.latestPost">
            </app-latest-post-widget>

            <mat-card class="calendar-card" role="region" aria-labelledby="my-dates">
              <mat-card-header>
                <mat-card-title id="my-dates">Meine Termine</mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <app-my-calendar [showTitle]="false"></app-my-calendar>
              </mat-card-content>
            </mat-card>
          </div>
        </section>
    </div>
  </div>
</div>
</ng-container>
